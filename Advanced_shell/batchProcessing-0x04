#!/bin/bash

# Directory to store PokÃ©mon data
DATA_DIR="pokemon_data"
POKEMON_LIST=(bulbasaur ivysaur venusaur charmander charmeleon)

# Create the data directory if it doesn't exist
mkdir -p "$DATA_DIR"

pids=()
cleanup() {
    echo "Cleaning up background processes..."
    for pid in "${pids[@]}"; do
        kill "$pid" 2>/dev/null || true
    done
}
trap cleanup EXIT INT TERM
for name in "${POKEMON_LIST[@]}"; do
    echo "Fetching data for $name..."
    API_URL="https://pokeapi.co/api/v2/pokemon/$name"
    OUTPUT_FILE="$DATA_DIR/${name}.json"
    # Fetch in background
    (curl -s -f -o "$OUTPUT_FILE" "$API_URL" && echo "Saved data to $OUTPUT_FILE" || echo "Failed to fetch data for $name") &
    pids+=("$!")
done

# Wait for all background jobs to finish
for pid in "${pids[@]}"; do
    wait "$pid"
done

echo "All fetches complete."
